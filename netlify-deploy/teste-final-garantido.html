<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ TESTE FINAL - BOTÃ•ES FUNCIONANDO</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container { 
            max-width: 900px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .step {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 4px solid #28a745;
        }
        .step.warning { border-left-color: #ffc107; }
        .step.error { border-left-color: #dc3545; }
        
        button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
            font-weight: bold;
        }
        button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
        }
        .urgent { background: linear-gradient(135deg, #dc3545, #c82333) !important; }
        .warning-btn { background: linear-gradient(135deg, #ffc107, #e0a800) !important; color: #000 !important; }
        
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: rgba(40, 167, 69, 0.8); }
        .error { background: rgba(220, 53, 69, 0.8); }
        .warning { background: rgba(255, 193, 7, 0.8); color: #000; }
        .info { background: rgba(23, 162, 184, 0.8); }
        
        h1 { text-align: center; margin-bottom: 30px; }
        .countdown {
            font-size: 48px;
            text-align: center;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ TESTE FINAL DOS BOTÃ•ES DE CONFIRMAÃ‡ÃƒO</h1>
        
        <div class="status warning">
            <strong>ğŸ¯ OBJETIVO:</strong> Provar que os botÃµes de confirmaÃ§Ã£o estÃ£o funcionando perfeitamente!
        </div>
        
        <div class="step">
            <h2>ğŸ“Š Etapa 1: Preparar Dados</h2>
            <p>Criar dados de teste garantidos para funcionamento:</p>
            <button onclick="prepararDadosGarantidos()">ğŸ†• PREPARAR DADOS GARANTIDOS</button>
            <div id="dados-status" class="status info">Aguardando preparaÃ§Ã£o...</div>
        </div>
        
        <div class="step">
            <h2>ğŸš€ Etapa 2: Abrir Admin</h2>
            <p>Abrir o painel admin com dados jÃ¡ preparados:</p>
            <button onclick="abrirAdminComDados()">ğŸ”§ ABRIR ADMIN COM DADOS</button>
            <div id="admin-status" class="status info">Aguardando abertura...</div>
        </div>
        
        <div class="step warning">
            <h2>âš ï¸ Etapa 3: Teste Manual</h2>
            <p>Na pÃ¡gina admin que abriu, siga estas instruÃ§Ãµes:</p>
            <ol>
                <li><strong>Procure a aba "Participantes"</strong></li>
                <li><strong>Deve haver registros com nomes "TESTE"</strong></li>
                <li><strong>Status "pending_donation" deve ter botÃµes âœ… Confirmar e âŒ Rejeitar</strong></li>
                <li><strong>Clique em um botÃ£o para testar</strong></li>
            </ol>
            <div id="instrucoes-status" class="status info">Aguardando teste manual...</div>
        </div>
        
        <div class="step">
            <h2>ğŸš¨ Etapa 4: EmergÃªncia (se necessÃ¡rio)</h2>
            <p>Se os botÃµes nÃ£o aparecerem, use estas opÃ§Ãµes:</p>
            <button onclick="ativarEmergencia()" class="urgent">ğŸš¨ ATIVAR EMERGÃŠNCIA</button>
            <button onclick="forcarBotoesConsole()" class="warning-btn">ğŸ’» FORÃ‡AR VIA CONSOLE</button>
            <div id="emergencia-status" class="status info">Pronto para emergÃªncia se necessÃ¡rio</div>
        </div>
        
        <div class="step">
            <h2>âœ… Resultado Esperado</h2>
            <div class="countdown" id="countdown">âœ… BOTÃ•ES FUNCIONANDO!</div>
            <p><strong>Se tudo estiver certo, vocÃª deve ver:</strong></p>
            <ul>
                <li>âœ… BotÃµes "Confirmar" e "Rejeitar" visÃ­veis</li>
                <li>âœ… BotÃµes respondem ao clique</li>
                <li>âœ… Popups de confirmaÃ§Ã£o aparecem</li>
                <li>âœ… Status dos registros muda</li>
            </ul>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            console.log(`[${time}] ${type.toUpperCase()}: ${message}`);
        }
        
        function updateStatus(id, message, type = 'info') {
            const el = document.getElementById(id);
            if (el) {
                el.textContent = message;
                el.className = `status ${type}`;
            }
        }
        
        function prepararDadosGarantidos() {
            log('ğŸ†• Preparando dados garantidos...', 'info');
            
            try {
                // Dados super explÃ­citos para teste
                const dadosGarantidos = [
                    {
                        id: 'teste-garantido-1',
                        buyerName: 'ğŸ”´ MARIA SILVA - TESTE DOAÃ‡ÃƒO PENDENTE',
                        buyerPhone: '(11) 91111-1111',
                        buyerEmail: 'maria.teste@email.com',
                        numbers: [1, 2, 3],
                        totalAmount: 120.00,
                        paymentMethod: 'donation',
                        status: 'pending_donation',
                        date: new Date().toISOString(),
                        timestamp: new Date().toISOString(),
                        notes: 'TESTE - DoaÃ§Ã£o de fraldas'
                    },
                    {
                        id: 'teste-garantido-2',
                        buyerName: 'ğŸ”´ JOÃƒO SANTOS - TESTE DOAÃ‡ÃƒO PENDENTE',
                        buyerPhone: '(11) 92222-2222',
                        buyerEmail: 'joao.teste@email.com',
                        numbers: [10, 20, 30],
                        totalAmount: 120.00,
                        paymentMethod: 'donation',
                        status: 'pending_donation',
                        date: new Date().toISOString(),
                        timestamp: new Date().toISOString(),
                        notes: 'TESTE - DoaÃ§Ã£o de fraldas'
                    },
                    {
                        id: 'teste-garantido-3',
                        buyerName: 'ğŸŸ¢ ANA COSTA - TESTE JÃ CONFIRMADA',
                        buyerPhone: '(11) 93333-3333',
                        buyerEmail: 'ana.teste@email.com',
                        numbers: [100],
                        totalAmount: 40.00,
                        paymentMethod: 'pix',
                        status: 'confirmed',
                        date: new Date().toISOString(),
                        timestamp: new Date().toISOString(),
                        notes: 'TESTE - Pagamento PIX confirmado'
                    }
                ];
                
                // Limpar dados antigos
                localStorage.removeItem('purchases');
                localStorage.removeItem('admin_purchases_backup');
                
                // Salvar dados garantidos
                localStorage.setItem('purchases', JSON.stringify(dadosGarantidos));
                localStorage.setItem('admin_purchases_backup', JSON.stringify(dadosGarantidos));
                
                // ConfiguraÃ§Ã£o bÃ¡sica
                const config = {
                    totalNumbers: 150,
                    ticketPrice: 40.00,
                    pixKey: 'teste@rifathomas.com',
                    prizes: {
                        first: 'R$ 1.000,00',
                        second: 'R$ 500,00',
                        third: 'Fraldas Pampers'
                    },
                    contactPhone: '(11) 99999-9999',
                    babyName: 'Thomas'
                };
                localStorage.setItem('rifaConfig', JSON.stringify(config));
                localStorage.setItem('adminConfig', JSON.stringify(config));
                
                log(`âœ… ${dadosGarantidos.length} dados garantidos criados e salvos`, 'success');
                updateStatus('dados-status', 'âœ… Dados garantidos criados! 2 doaÃ§Ãµes pendentes + 1 confirmada', 'success');
                
                // Mostrar resumo
                setTimeout(() => {
                    log('ğŸ“Š RESUMO DOS DADOS CRIADOS:', 'info');
                    dadosGarantidos.forEach((item, index) => {
                        log(`${index + 1}. ${item.buyerName} - Status: ${item.status}`, 'info');
                    });
                }, 1000);
                
            } catch (error) {
                log(`âŒ Erro ao preparar dados: ${error.message}`, 'error');
                updateStatus('dados-status', `âŒ Erro: ${error.message}`, 'error');
            }
        }
        
        function abrirAdminComDados() {
            log('ğŸš€ Abrindo admin com dados preparados...', 'info');
            
            // Verificar se dados existem
            const purchases = localStorage.getItem('purchases');
            if (!purchases) {
                updateStatus('admin-status', 'âŒ Dados nÃ£o encontrados! Prepare os dados primeiro.', 'error');
                return;
            }
            
            const parsed = JSON.parse(purchases);
            log(`ğŸ“Š Dados encontrados: ${parsed.length} registros`, 'success');
            
            // Abrir admin
            const adminWindow = window.open('admin.html', '_blank', 'width=1200,height=800,toolbar=yes,location=yes,status=yes,menubar=yes,scrollbars=yes,resizable=yes');
            
            if (adminWindow) {
                updateStatus('admin-status', 'âœ… Admin aberto! Verifique a nova aba agora.', 'success');
                
                // InstruÃ§Ãµes detalhadas
                setTimeout(() => {
                    updateStatus('instrucoes-status', 'ğŸ‘† AGORA: VÃ¡ para a nova aba do admin e teste os botÃµes!', 'warning');
                    
                    log('ğŸ“‹ INSTRUÃ‡Ã•ES PARA A NOVA ABA:', 'warning');
                    log('1. Aguarde o carregamento completo (atÃ© 10 segundos)', 'info');
                    log('2. Clique na aba "Participantes" se nÃ£o estiver visÃ­vel', 'info');
                    log('3. Procure por "MARIA SILVA - TESTE" e "JOÃƒO SANTOS - TESTE"', 'info');
                    log('4. Verifique se hÃ¡ botÃµes "âœ… Confirmar" e "âŒ Rejeitar"', 'info');
                    log('5. Clique em um botÃ£o para testar', 'info');
                    log('6. Se nÃ£o houver botÃµes, use a seÃ§Ã£o amarela "CORREÃ‡ÃƒO DE EMERGÃŠNCIA"', 'warning');
                }, 2000);
            } else {
                updateStatus('admin-status', 'âŒ Erro ao abrir admin - popup bloqueado?', 'error');
                log('âŒ Popup pode estar bloqueado. Abra manualmente: admin.html', 'error');
            }
        }
        
        function ativarEmergencia() {
            log('ğŸš¨ Ativando emergÃªncia...', 'warning');
            
            // Tentar executar funÃ§Ã£o de emergÃªncia se estiver na mesma pÃ¡gina
            try {
                if (typeof window.forcarBotoesEmergencia === 'function') {
                    window.forcarBotoesEmergencia();
                    updateStatus('emergencia-status', 'âœ… EmergÃªncia ativada nesta pÃ¡gina!', 'success');
                } else {
                    updateStatus('emergencia-status', 'âš ï¸ Abra o console na aba do admin e execute: window.forcarBotoesEmergencia()', 'warning');
                }
            } catch (error) {
                log(`âŒ Erro na emergÃªncia: ${error.message}`, 'error');
                updateStatus('emergencia-status', 'âŒ Erro na emergÃªncia. Use o console manual.', 'error');
            }
        }
        
        function forcarBotoesConsole() {
            log('ğŸ’» InstruÃ§Ãµes para console...', 'info');
            
            const instrucoes = `
1. Abra o Console no admin (pressione F12)
2. Clique na aba "Console"
3. Digite este comando:
   window.forcarBotoesEmergencia()
4. Pressione Enter
5. Aguarde a mensagem de sucesso
            `;
            
            alert(`ğŸ’» INSTRUÃ‡Ã•ES PARA O CONSOLE:\n${instrucoes}`);
            updateStatus('emergencia-status', 'ğŸ’» InstruÃ§Ãµes de console exibidas. Use na aba do admin.', 'info');
        }
        
        // Auto-executar verificaÃ§Ã£o
        window.addEventListener('load', function() {
            log('ğŸ¯ Teste final carregado', 'success');
            
            // Verificar se jÃ¡ existem dados
            const existing = localStorage.getItem('purchases');
            if (existing) {
                const parsed = JSON.parse(existing);
                log(`ğŸ“Š Dados existentes encontrados: ${parsed.length} registros`, 'info');
                updateStatus('dados-status', `ğŸ“Š Dados jÃ¡ existem (${parsed.length} registros). Pode abrir o admin.`, 'warning');
            }
        });
    </script>
</body>
</html>
