<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEBUG URGENTE - Teste de Bot√µes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-box { background: #f8f9fa; padding: 15px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        button { margin: 5px; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        .test-result { font-family: monospace; white-space: pre-wrap; background: #000; color: #0f0; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üö® DEBUG URGENTE - Teste de Bot√µes Admin</h1>
    
    <div class="debug-box warning">
        <h3>üéØ Objetivo: Identificar por que os bot√µes n√£o aparecem</h3>
        <p>Este teste vai simular exatamente o que acontece no admin.js</p>
    </div>
    
    <div class="debug-box">
        <h3>üß™ Teste 1: Fun√ß√£o createActionButtons Isolada</h3>
        <button onclick="testarFuncaoIsolada()">Testar Fun√ß√£o Isolada</button>
        <div id="teste1"></div>
    </div>
    
    <div class="debug-box">
        <h3>üîå Teste 2: Carregar Admin.js e Testar</h3>
        <button onclick="testarComAdminJs()">Testar com Admin.js</button>
        <div id="teste2"></div>
    </div>
    
    <div class="debug-box">
        <h3>üåê Teste 3: Simular Dados Reais do Firebase</h3>
        <button onclick="testarComDadosReais()">Testar com Dados Reais</button>
        <div id="teste3"></div>
    </div>
    
    <div class="debug-box">
        <h3>üìä Resultados dos Testes</h3>
        <div id="resultados"></div>
    </div>

    <script>
        console.log('üöÄ P√°gina de debug carregada');
        
        // Fun√ß√£o createActionButtons isolada (copiada do admin.js)
        function createActionButtonsLocal(purchase) {
            console.log(`üîß [BUTTON-DEBUG] *** CRIANDO BOT√ïES PARA: ${purchase.id} ***`);
            
            // FORCE criar bot√µes b√°sicos SEMPRE - sem condi√ß√µes
            let buttonsHtml = `
                <button class="btn-edit" data-action="edit-participant" data-purchase-id="${purchase.id}" title="Editar" style="background: #007bff; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">
                    ‚úèÔ∏è Editar
                </button>
                <button onclick="console.log('Debug compra:', ${JSON.stringify(purchase).replace(/"/g, '&quot;')})" title="Debug" style="background: #6c757d; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">
                    üîç Debug
                </button>
            `;
            
            console.log(`‚úÖ [BUTTON-DEBUG] Bot√µes b√°sicos SEMPRE criados para: ${purchase.id}`);
            
            // Agora verificar se precisa adicionar bot√µes de confirma√ß√£o
            try {
                const status = (purchase.status || '').toString().toLowerCase();
                const tipo = (purchase.tipo || '').toString().toLowerCase();
                const metodo = (purchase.paymentMethod || purchase.metodoPagamento || '').toString().toLowerCase();
                
                console.log(`üìä [BUTTON-DEBUG] Dados da compra ${purchase.id}:`);
                console.log(`   - Status: "${status}"`);
                console.log(`   - Tipo: "${tipo}"`);
                console.log(`   - M√©todo: "${metodo}"`);
                
                // Verificar se √© doa√ß√£o (bem simples)
                const ehDoacao = tipo.includes('doacao') || 
                                tipo.includes('doa√ß√£o') || 
                                metodo.includes('doacao') || 
                                metodo.includes('doa√ß√£o');
                
                // Verificar se √© pendente (bem simples)  
                const ehPendente = status.includes('pendente') || status.includes('pending');
                
                console.log(`   - √â doa√ß√£o? ${ehDoacao}`);
                console.log(`   - √â pendente? ${ehPendente}`);
                
                if (ehDoacao && ehPendente) {
                    buttonsHtml = `
                        <button class="btn-confirm" data-action="confirm-donation" data-purchase-id="${purchase.id}" title="Confirmar Doa√ß√£o" style="background: #28a745; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">
                            ‚úÖ Confirmar
                        </button>
                        <button class="btn-reject" data-action="reject-donation" data-purchase-id="${purchase.id}" title="Rejeitar Doa√ß√£o" style="background: #dc3545; color: white; border: none; padding: 5px 10px; margin: 2px; border-radius: 4px; cursor: pointer;">
                            ‚ùå Rejeitar
                        </button>
                    ` + buttonsHtml;
                    
                    console.log(`‚úÖ [BUTTON-DEBUG] Bot√µes de confirma√ß√£o ADICIONADOS para doa√ß√£o pendente: ${purchase.id}`);
                } else {
                    console.log(`‚ÑπÔ∏è [BUTTON-DEBUG] Sem bot√µes de confirma√ß√£o para: ${purchase.id} (n√£o √© doa√ß√£o pendente)`);
                }
                
            } catch (error) {
                console.error(`‚ùå [BUTTON-DEBUG] ERRO ao processar bot√µes para ${purchase.id}:`, error);
            }
            
            console.log(`üéØ [BUTTON-DEBUG] HTML FINAL dos bot√µes para ${purchase.id}:`, buttonsHtml);
            console.log(`üìè [BUTTON-DEBUG] Tamanho do HTML: ${buttonsHtml.length} caracteres`);
            
            return buttonsHtml;
        }
        
        // Teste 1: Fun√ß√£o isolada
        function testarFuncaoIsolada() {
            const div = document.getElementById('teste1');
            div.innerHTML = '<div>üîÑ Testando fun√ß√£o isolada...</div>';
            
            // Dados de teste
            const dadosTeste = [
                { id: 'test1', status: 'PENDENTE', tipo: 'Doa√ß√£o', buyerName: 'Jo√£o' },
                { id: 'test2', status: 'pendente', metodoPagamento: 'doacao', buyerName: 'Maria' },
                { id: 'test3', status: 'confirmado', tipo: 'compra', buyerName: 'Jos√©' }
            ];
            
            let resultado = '<div class="test-result">';
            
            dadosTeste.forEach(purchase => {
                resultado += `\\n=== TESTE PARA ${purchase.id} ===\\n`;
                const botoes = createActionButtonsLocal(purchase);
                resultado += `HTML gerado: ${botoes}\\n`;
                resultado += `Tamanho: ${botoes.length} caracteres\\n`;
                resultado += `Cont√©m "Editar": ${botoes.includes('Editar')}\\n`;
                resultado += `Cont√©m "Debug": ${botoes.includes('Debug')}\\n`;
                resultado += `Cont√©m "Confirmar": ${botoes.includes('Confirmar')}\\n`;
                resultado += '\\n';
            });
            
            resultado += '</div>';
            
            // Tamb√©m mostrar os bot√µes renderizados
            resultado += '<h4>üé® Bot√µes Renderizados:</h4>';
            dadosTeste.forEach(purchase => {
                resultado += `<div style="border: 1px solid #ccc; margin: 10px 0; padding: 10px;">`;
                resultado += `<strong>${purchase.id} (${purchase.buyerName}):</strong><br>`;
                resultado += createActionButtonsLocal(purchase);
                resultado += '</div>';
            });
            
            div.innerHTML = resultado;
        }
        
        // Teste 2: Com admin.js
        function testarComAdminJs() {
            const div = document.getElementById('teste2');
            div.innerHTML = '<div>üîÑ Carregando admin.js...</div>';
            
            const script = document.createElement('script');
            script.src = 'admin.js';
            script.onload = function() {
                try {
                    div.innerHTML = '<div class="success">‚úÖ Admin.js carregado com sucesso!</div>';
                    
                    if (typeof createActionButtons === 'function') {
                        div.innerHTML += '<div class="success">‚úÖ Fun√ß√£o createActionButtons encontrada!</div>';
                        
                        const testPurchase = { id: 'admin-test', status: 'PENDENTE', tipo: 'Doa√ß√£o', buyerName: 'Teste Admin' };
                        const result = createActionButtons(testPurchase);
                        
                        div.innerHTML += `<div class="debug-box">
                            <h4>Resultado do admin.js:</h4>
                            <div class="test-result">${result}</div>
                            <h4>Renderizado:</h4>
                            ${result}
                        </div>`;
                        
                    } else {
                        div.innerHTML += '<div class="error">‚ùå Fun√ß√£o createActionButtons N√ÉO encontrada no admin.js!</div>';
                    }
                } catch (error) {
                    div.innerHTML = `<div class="error">‚ùå Erro ao testar admin.js: ${error.message}</div>`;
                }
            };
            script.onerror = function() {
                div.innerHTML = '<div class="error">‚ùå Erro ao carregar admin.js</div>';
            };
            document.head.appendChild(script);
        }
        
        // Teste 3: Com dados reais
        function testarComDadosReais() {
            const div = document.getElementById('teste3');
            div.innerHTML = '<div>üîÑ Testando com dados que parecem reais...</div>';
            
            // Simular dados baseados na imagem que voc√™ mostrou
            const dadosReais = [
                {
                    id: 'real1',
                    buyerName: 'jos√© carlos silva costa',
                    buyerPhone: '(85) 99999-9998',
                    status: 'PENDENTE',
                    tipo: 'PIX',
                    paymentMethod: 'PIX',
                    totalAmount: 40
                },
                {
                    id: 'real2', 
                    buyerName: 'Teste 2',
                    buyerPhone: '(95) 99898-8888',
                    status: 'REJEITADO',
                    tipo: 'Doa√ß√£o',
                    metodoPagamento: 'Doa√ß√£o',
                    totalAmount: 40
                },
                {
                    id: 'real3',
                    buyerName: 'Jo√£o Victor',
                    buyerPhone: '(85) 98843-2761', 
                    status: 'CONFIRMADO',
                    tipo: 'Doa√ß√£o',
                    metodoPagamento: 'Doa√ß√£o',
                    totalAmount: 40
                }
            ];
            
            let resultado = '<div class="test-result">TESTE COM DADOS REAIS:\\n\\n';
            
            dadosReais.forEach(purchase => {
                resultado += `=== ${purchase.buyerName} ===\\n`;
                resultado += `Status: ${purchase.status}\\n`;
                resultado += `Tipo: ${purchase.tipo}\\n`;
                resultado += `M√©todo: ${purchase.metodoPagamento || purchase.paymentMethod}\\n`;
                
                const botoes = createActionButtonsLocal(purchase);
                resultado += `Bot√µes gerados: ${botoes.length > 0 ? 'SIM' : 'N√ÉO'}\\n`;
                resultado += `HTML: ${botoes.substring(0, 100)}...\\n\\n`;
            });
            
            resultado += '</div>';
            
            // Renderizar os bot√µes
            resultado += '<h4>üé® Bot√µes dos Dados Reais:</h4>';
            dadosReais.forEach(purchase => {
                resultado += `<div style="border: 1px solid #ccc; margin: 10px 0; padding: 10px; background: #f9f9f9;">`;
                resultado += `<strong>${purchase.buyerName}</strong> (${purchase.status})<br>`;
                resultado += createActionButtonsLocal(purchase);
                resultado += '</div>';
            });
            
            div.innerHTML = resultado;
        }
        
        // Mostrar console no documento tamb√©m
        const originalLog = console.log;
        const originalError = console.error;
        let logOutput = '';
        
        console.log = function(...args) {
            logOutput += args.join(' ') + '\\n';
            originalLog.apply(console, arguments);
            
            const resultDiv = document.getElementById('resultados');
            if (resultDiv) {
                resultDiv.innerHTML = `<div class="test-result">${logOutput}</div>`;
            }
        };
        
        console.error = function(...args) {
            logOutput += 'ERROR: ' + args.join(' ') + '\\n';
            originalError.apply(console, arguments);
            
            const resultDiv = document.getElementById('resultados');
            if (resultDiv) {
                resultDiv.innerHTML = `<div class="test-result">${logOutput}</div>`;
            }
        };
    </script>
</body>
</html>
