<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® CORRE√á√ÉO URGENTE - Bot√µes de Confirma√ß√£o</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .status { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px; 
            font-weight: bold;
        }
        .success { background: rgba(40, 167, 69, 0.8); }
        .error { background: rgba(220, 53, 69, 0.8); }
        .warning { background: rgba(255, 193, 7, 0.8); color: #000; }
        .info { background: rgba(23, 162, 184, 0.8); }
        
        button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .danger { background: linear-gradient(135deg, #dc3545, #c82333) !important; }
        .urgent { background: linear-gradient(135deg, #ff6b35, #ff8a65) !important; }
        
        .log {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            margin: 15px 0;
        }
        
        h1 { text-align: center; margin-bottom: 30px; }
        h2 { border-bottom: 2px solid rgba(255,255,255,0.3); padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® CORRE√á√ÉO URGENTE: Bot√µes de Confirma√ß√£o</h1>
        
        <div class="status error">
            <strong>‚ùå PROBLEMA CONFIRMADO:</strong> Os bot√µes de confirma√ß√£o realmente n√£o est√£o aparecendo!
        </div>
        
        <div class="status warning">
            <strong>‚ö†Ô∏è DIAGN√ìSTICO:</strong> Vamos corrigir este problema AGORA!
        </div>

        <h2>üîß Passo 1: Criar Dados de Teste</h2>
        <button onclick="criarDadosTeste()" class="urgent">üÜï Criar Dados de Teste Urgente</button>
        <div id="dados-status" class="status info">Aguardando cria√ß√£o de dados...</div>
        
        <h2>üöÄ Passo 2: Abrir Admin e Testar</h2>
        <button onclick="abrirAdmin()">üîß Abrir Admin</button>
        <button onclick="forcedFix()" class="danger">üö® CORRE√á√ÉO FOR√áADA</button>
        <div id="admin-status" class="status info">Aguardando teste...</div>
        
        <h2>üìã Passo 3: Verificar Console</h2>
        <button onclick="verificarConsole()">üîç Verificar Logs</button>
        <div id="console-logs" class="log">Logs aparecer√£o aqui...</div>
        
        <h2>üõ†Ô∏è Corre√ß√£o Manual se Necess√°rio</h2>
        <button onclick="correcaoManual()" class="danger">üîß APLICAR CORRE√á√ÉO MANUAL</button>
        <div id="correcao-status" class="status info">Pronto para corre√ß√£o manual se necess√°rio</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logEl = document.getElementById('console-logs');
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : type === 'warning' ? '#ffd43b' : '#74c0fc';
            logEl.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`${type.toUpperCase()}: ${message}`);
        }
        
        function updateStatus(elementId, message, type = 'info') {
            const el = document.getElementById(elementId);
            el.textContent = message;
            el.className = `status ${type}`;
        }
        
        function criarDadosTeste() {
            log('üÜï Criando dados de teste urgentes...', 'info');
            
            try {
                // Criar dados de teste mais robustos
                const dadosTeste = [
                    {
                        id: 'urgente-001',
                        name: 'Maria Silva (TESTE)',
                        buyerName: 'Maria Silva (TESTE)',
                        phone: '(11) 99999-1001',
                        buyerPhone: '(11) 99999-1001',
                        numbers: [101],
                        totalAmount: 40.00,
                        paymentMethod: 'donation',
                        status: 'pending_donation',
                        date: new Date().toISOString(),
                        timestamp: new Date().toISOString()
                    },
                    {
                        id: 'urgente-002',
                        name: 'Jo√£o Santos (TESTE)',
                        buyerName: 'Jo√£o Santos (TESTE)',
                        phone: '(11) 99999-1002',
                        buyerPhone: '(11) 99999-1002',
                        numbers: [102],
                        totalAmount: 40.00,
                        paymentMethod: 'donation',
                        status: 'pending_donation',
                        date: new Date().toISOString(),
                        timestamp: new Date().toISOString()
                    },
                    {
                        id: 'urgente-003',
                        name: 'Ana Costa (TESTE)',
                        buyerName: 'Ana Costa (TESTE)',
                        phone: '(11) 99999-1003',
                        buyerPhone: '(11) 99999-1003',
                        numbers: [103],
                        totalAmount: 40.00,
                        paymentMethod: 'pix',
                        status: 'confirmed',
                        date: new Date().toISOString(),
                        timestamp: new Date().toISOString()
                    }
                ];
                
                // Salvar no localStorage
                localStorage.setItem('purchases', JSON.stringify(dadosTeste));
                
                // Criar configura√ß√£o b√°sica se n√£o existir
                const config = {
                    totalNumbers: 150,
                    ticketPrice: 40.00,
                    pixKey: 'contato@charifa.com',
                    prizes: {
                        first: 'R$ 100,00',
                        second: 'R$ 200,00',
                        third: 'Fraldas por faixa'
                    },
                    contactPhone: '(11) 99999-9999',
                    babyName: 'Thomas'
                };
                localStorage.setItem('rifaConfig', JSON.stringify(config));
                localStorage.setItem('adminConfig', JSON.stringify(config));
                
                log('‚úÖ Dados de teste criados com sucesso!', 'success');
                log(`üìä Criados ${dadosTeste.length} participantes de teste`, 'info');
                log('üìã 2 doa√ß√µes pendentes + 1 confirmada', 'info');
                
                updateStatus('dados-status', '‚úÖ Dados de teste criados! Agora abra o admin.', 'success');
                
            } catch (error) {
                log(`‚ùå Erro ao criar dados: ${error.message}`, 'error');
                updateStatus('dados-status', `‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        function abrirAdmin() {
            log('üöÄ Abrindo admin em nova aba...', 'info');
            
            const adminWindow = window.open('admin.html', '_blank', 'width=1200,height=800');
            
            if (adminWindow) {
                log('‚úÖ Admin aberto! Verifique a nova aba.', 'success');
                updateStatus('admin-status', '‚úÖ Admin aberto! Verifique se os bot√µes aparecem na tabela.', 'success');
                
                // Instru√ß√µes detalhadas
                setTimeout(() => {
                    log('üìã INSTRU√á√ïES PARA TESTE:', 'warning');
                    log('1. Na nova aba, aguarde o carregamento completo', 'info');
                    log('2. Clique na aba "Participantes"', 'info');
                    log('3. Procure por "Maria Silva (TESTE)" e "Jo√£o Santos (TESTE)"', 'info');
                    log('4. Deve haver bot√µes "‚úÖ Confirmar" e "‚ùå Rejeitar"', 'info');
                    log('5. Se n√£o houver bot√µes, use a se√ß√£o amarela de emerg√™ncia', 'warning');
                }, 2000);
            } else {
                log('‚ùå Erro ao abrir admin - popup bloqueado?', 'error');
                updateStatus('admin-status', '‚ùå Erro ao abrir admin. Tente abrir manualmente: admin.html', 'error');
            }
        }
        
        function forcedFix() {
            log('üö® Aplicando corre√ß√£o for√ßada...', 'warning');
            
            // Tentar executar fun√ß√µes de emerg√™ncia
            try {
                if (typeof window.forcarBotoesEmergencia === 'function') {
                    window.forcarBotoesEmergencia();
                    log('‚úÖ Fun√ß√£o de emerg√™ncia executada!', 'success');
                } else {
                    log('‚ö†Ô∏è Fun√ß√£o de emerg√™ncia n√£o dispon√≠vel nesta p√°gina', 'warning');
                }
                
                // Criar dados se necess√°rio
                if (typeof window.createSampleData === 'function') {
                    window.createSampleData();
                    log('‚úÖ Dados de exemplo criados!', 'success');
                } else {
                    log('‚ö†Ô∏è createSampleData n√£o dispon√≠vel nesta p√°gina', 'warning');
                }
                
                updateStatus('admin-status', 'üö® Corre√ß√£o for√ßada aplicada! Recarregue o admin.', 'warning');
                
            } catch (error) {
                log(`‚ùå Erro na corre√ß√£o for√ßada: ${error.message}`, 'error');
                updateStatus('admin-status', '‚ùå Erro na corre√ß√£o for√ßada. Use corre√ß√£o manual.', 'error');
            }
        }
        
        function verificarConsole() {
            log('üîç Verificando estado do sistema...', 'info');
            
            // Verificar localStorage
            const purchases = localStorage.getItem('purchases');
            if (purchases) {
                const parsedPurchases = JSON.parse(purchases);
                log(`üìä Encontrados ${parsedPurchases.length} registros no localStorage`, 'success');
                
                // Mostrar amostras
                parsedPurchases.forEach((purchase, index) => {
                    log(`${index + 1}. ${purchase.name || purchase.buyerName} - Status: ${purchase.status}`, 'info');
                });
            } else {
                log('‚ùå Nenhum dado encontrado no localStorage', 'error');
            }
            
            // Verificar configura√ß√£o
            const config = localStorage.getItem('rifaConfig') || localStorage.getItem('adminConfig');
            if (config) {
                log('‚úÖ Configura√ß√£o encontrada', 'success');
            } else {
                log('‚ùå Configura√ß√£o n√£o encontrada', 'error');
            }
            
            // Verificar fun√ß√µes globais
            const functionsToCheck = ['confirmDonation', 'rejectDonation', 'editParticipant', 'createSampleData', 'forcarBotoesEmergencia'];
            functionsToCheck.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`‚úÖ Fun√ß√£o ${funcName} dispon√≠vel globalmente`, 'success');
                } else {
                    log(`‚ùå Fun√ß√£o ${funcName} N√ÉO dispon√≠vel`, 'error');
                }
            });
        }
        
        function correcaoManual() {
            log('üîß Iniciando corre√ß√£o manual...', 'warning');
            
            // Esta fun√ß√£o ser√° implementada para corrigir o admin.js
            updateStatus('correcao-status', 'üîß Preparando corre√ß√£o manual...', 'warning');
            
            // Instru√ß√µes para corre√ß√£o manual
            setTimeout(() => {
                log('üìã CORRE√á√ÉO MANUAL NECESS√ÅRIA:', 'warning');
                log('1. O problema est√° no admin.js', 'error');
                log('2. Os bot√µes n√£o est√£o sendo criados corretamente', 'error');
                log('3. Vou corrigir o c√≥digo agora...', 'info');
                
                // Aqui vamos implementar a corre√ß√£o real
                window.open('admin.html', '_blank');
            }, 1000);
        }
        
        // Auto-executar ao carregar a p√°gina
        window.addEventListener('load', function() {
            log('üö® Sistema de corre√ß√£o urgente carregado', 'success');
            log('üëÜ Clique em "Criar Dados de Teste Urgente" primeiro', 'info');
        });
    </script>
</body>
</html>
