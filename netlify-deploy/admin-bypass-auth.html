<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üÜò Admin - Bypass de Autentica√ß√£o</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .content {
            padding: 30px;
        }
        
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        
        .btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .btn.danger {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
        }
        
        .btn.secondary {
            background: linear-gradient(135deg, #6c757d, #495057);
        }
        
        .input-group {
            margin: 15px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üÜò Sistema de Bypass de Autentica√ß√£o</h1>
            <p>Acesso emergencial ao painel administrativo</p>
        </div>
        
        <div class="content">
            <div class="warning-box">
                <h3>‚ö†Ô∏è Sistema de Emerg√™ncia</h3>
                <p>Este √© um sistema de bypass tempor√°rio para acessar o admin quando h√° problemas de autentica√ß√£o Firebase. Use apenas em emerg√™ncias.</p>
            </div>
            
            <div id="status" class="status info">
                üîç Verificando sistema de autentica√ß√£o...
            </div>
            
            <div class="input-group">
                <label for="admin-code">üîê C√≥digo de Administrador:</label>
                <input type="password" id="admin-code" placeholder="Digite o c√≥digo admin">
            </div>
            
            <button class="btn" onclick="bypassAuth()">üöÄ Acessar Admin</button>
            <button class="btn secondary" onclick="testFirebaseAuth()">üîß Testar Firebase Auth</button>
            <button class="btn danger" onclick="implementPermanentFix()">üõ†Ô∏è Implementar Corre√ß√£o Permanente</button>
            
            <div id="log" class="log" style="display: none;">
                <strong>Log do Sistema:</strong><br>
                <div id="log-content"></div>
            </div>
            
            <hr style="margin: 30px 0;">
            
            <h3>üîó Op√ß√µes de Acesso:</h3>
            <a href="admin.html" class="btn secondary">üìä Admin Original</a>
            <a href="login.html" class="btn secondary">üîê Login Normal</a>
            
        </div>
    </div>

    <script>
        // C√≥digo master do administrador
        const ADMIN_CODE = 'RIFATHOMAS2025';
        
        function log(message, type = 'info') {
            console.log(message);
            const logDiv = document.getElementById('log');
            const logContent = document.getElementById('log-content');
            
            logDiv.style.display = 'block';
            logContent.innerHTML += `<div style="color: ${getLogColor(type)};">[${new Date().toLocaleTimeString()}] ${message}</div>`;
            logContent.scrollTop = logContent.scrollHeight;
        }
        
        function getLogColor(type) {
            switch(type) {
                case 'success': return '#28a745';
                case 'error': return '#dc3545';
                case 'warning': return '#ffc107';
                default: return '#6c757d';
            }
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }
        
        // Bypass de autentica√ß√£o usando c√≥digo
        function bypassAuth() {
            const code = document.getElementById('admin-code').value;
            
            if (!code) {
                updateStatus('‚ùå Digite o c√≥digo de administrador', 'error');
                return;
            }
            
            if (code === ADMIN_CODE) {
                log('‚úÖ C√≥digo correto! Criando sess√£o de bypass...', 'success');
                
                // Criar sess√£o de emerg√™ncia
                localStorage.setItem('adminBypass', 'true');
                localStorage.setItem('adminBypassTime', Date.now().toString());
                localStorage.setItem('bypassReason', 'Firebase Auth Issue');
                
                updateStatus('‚úÖ Bypass ativado! Redirecionando...', 'success');
                
                // Criar p√°gina admin de emerg√™ncia
                createEmergencyAdmin();
                
            } else {
                updateStatus('‚ùå C√≥digo incorreto', 'error');
                log('‚ùå Tentativa de acesso com c√≥digo inv√°lido', 'error');
            }
        }
        
        // Criar p√°gina admin de emerg√™ncia
        function createEmergencyAdmin() {
            log('üõ†Ô∏è Criando sistema admin de emerg√™ncia...', 'info');
            
            // Redirecionar para uma p√°gina admin simplificada
            setTimeout(() => {
                window.location.href = 'admin-emergency.html';
            }, 2000);
        }
        
        // Testar Firebase Auth atual
        async function testFirebaseAuth() {
            updateStatus('üîß Testando Firebase Auth...', 'info');
            log('Iniciando teste do Firebase Auth...', 'info');
            
            try {
                // Verificar se Firebase est√° carregado
                if (typeof firebase === 'undefined') {
                    throw new Error('Firebase n√£o est√° carregado');
                }
                
                log('‚úÖ Firebase scripts carregados', 'success');
                
                // Verificar se FirebaseDB est√° dispon√≠vel
                if (typeof window.FirebaseDB === 'undefined') {
                    throw new Error('FirebaseDB n√£o est√° dispon√≠vel');
                }
                
                log('‚úÖ FirebaseDB encontrado', 'success');
                
                // Testar autentica√ß√£o an√¥nima
                const anonResult = await window.FirebaseDB.initAuth();
                if (anonResult && anonResult.uid) {
                    log(`‚úÖ Autentica√ß√£o an√¥nima OK: ${anonResult.uid}`, 'success');
                } else {
                    throw new Error('Falha na autentica√ß√£o an√¥nima');
                }
                
                // Testar login admin
                const loginResult = await window.FirebaseDB.adminLogin('admin@rifathomas.com', 'casaVERDE123');
                if (loginResult.success) {
                    log('‚úÖ Login admin funcionando!', 'success');
                    updateStatus('‚úÖ Firebase Auth est√° funcionando! Tente acessar o admin normal.', 'success');
                } else {
                    throw new Error(`Falha no login admin: ${loginResult.error}`);
                }
                
            } catch (error) {
                log(`‚ùå Erro no teste: ${error.message}`, 'error');
                updateStatus(`‚ùå Firebase Auth com problemas: ${error.message}`, 'error');
            }
        }
        
        // Implementar corre√ß√£o permanente
        async function implementPermanentFix() {
            updateStatus('üõ†Ô∏è Implementando corre√ß√£o permanente...', 'warning');
            log('Iniciando corre√ß√£o permanente do sistema de autentica√ß√£o...', 'info');
            
            try {
                // Criar sistema de autentica√ß√£o alternativo
                const altAuthSystem = {
                    // Sistema simples baseado em localStorage com criptografia b√°sica
                    encrypt(text) {
                        return btoa(text);
                    },
                    
                    decrypt(encoded) {
                        try {
                            return atob(encoded);
                        } catch {
                            return null;
                        }
                    },
                    
                    login(password) {
                        const validPassword = 'casaVERDE123';
                        if (password === validPassword) {
                            const token = this.encrypt(`admin-${Date.now()}`);
                            localStorage.setItem('adminToken', token);
                            localStorage.setItem('adminEmail', 'admin@rifathomas.com');
                            return { success: true };
                        }
                        return { success: false, error: 'Senha incorreta' };
                    },
                    
                    isAuthenticated() {
                        const token = localStorage.getItem('adminToken');
                        if (!token) return false;
                        
                        const decoded = this.decrypt(token);
                        return decoded && decoded.startsWith('admin-');
                    },
                    
                    logout() {
                        localStorage.removeItem('adminToken');
                        localStorage.removeItem('adminEmail');
                    }
                };
                
                // Salvar sistema alternativo
                window.AltAuth = altAuthSystem;
                
                log('‚úÖ Sistema de autentica√ß√£o alternativo criado', 'success');
                updateStatus('‚úÖ Sistema alternativo implementado! Redirecionando...', 'success');
                
                setTimeout(() => {
                    window.location.href = 'admin-simple.html';
                }, 3000);
                
            } catch (error) {
                log(`‚ùå Erro na implementa√ß√£o: ${error.message}`, 'error');
                updateStatus(`‚ùå Falha na corre√ß√£o: ${error.message}`, 'error');
            }
        }
        
        // Verifica√ß√£o inicial do sistema
        window.addEventListener('DOMContentLoaded', async function() {
            log('Sistema de bypass iniciado', 'info');
            
            // Verificar se h√° bypass ativo
            const bypassActive = localStorage.getItem('adminBypass');
            if (bypassActive === 'true') {
                const bypassTime = localStorage.getItem('adminBypassTime');
                const timeElapsed = Date.now() - parseInt(bypassTime);
                
                if (timeElapsed < 3600000) { // 1 hora
                    updateStatus('‚ö†Ô∏è Bypass ativo h√° ' + Math.round(timeElapsed/60000) + ' minutos', 'warning');
                } else {
                    localStorage.removeItem('adminBypass');
                    localStorage.removeItem('adminBypassTime');
                }
            }
            
            // Aguardar e tentar carregar Firebase
            setTimeout(async () => {
                try {
                    if (typeof window.FirebaseDB !== 'undefined') {
                        updateStatus('üîß Firebase detectado - testando...', 'info');
                        await testFirebaseAuth();
                    } else {
                        updateStatus('‚ö†Ô∏è Firebase n√£o carregado - use o bypass', 'warning');
                    }
                } catch (error) {
                    log(`Erro na verifica√ß√£o inicial: ${error.message}`, 'error');
                }
            }, 2000);
        });
    </script>
    
    <!-- Tentar carregar Firebase se dispon√≠vel -->
    <script src="firebase-config.js" onerror="console.log('Firebase config n√£o dispon√≠vel')"></script>
</body>
</html>
