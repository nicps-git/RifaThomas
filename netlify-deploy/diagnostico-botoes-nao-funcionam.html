<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”§ DIAGNÃ“STICO URGENTE - BotÃµes NÃ£o Funcionam</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .status-ok { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .btn {
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-danger { background: #dc3545; color: white; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 2px solid #007bff;
            border-radius: 5px;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ DIAGNÃ“STICO URGENTE - BotÃµes NÃ£o Funcionam</h1>
        
        <div class="status status-error">
            âŒ PROBLEMA: Os botÃµes nÃ£o estÃ£o funcionando conforme esperado
        </div>

        <div class="test-section">
            <h2>ğŸ¯ Testes de DiagnÃ³stico</h2>
            <button class="btn btn-danger" onclick="testeCompleto()">ğŸ§ª Executar Teste Completo</button>
            <button class="btn btn-primary" onclick="abrirAdminParaTeste()">ğŸ”— Abrir Admin em Nova Aba</button>
            <button class="btn btn-success" onclick="criarBotoesDeEmergencia()">ğŸš¨ Criar BotÃµes de EmergÃªncia</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š Log de DiagnÃ³stico</h2>
            <div id="logOutput" class="log">Aguardando diagnÃ³stico...</div>
        </div>

        <div class="test-section">
            <h2>ğŸ› ï¸ SoluÃ§Ãµes de EmergÃªncia</h2>
            <div id="solucoes" style="display: none;">
                <h3>ğŸ“‹ Cole no Console da PÃ¡gina Admin (F12):</h3>
                <textarea id="codigoEmergencia" readonly style="width: 100%; height: 300px; background: #000; color: #0f0; padding: 10px; font-family: monospace; border: 1px solid #ccc; border-radius: 5px;"></textarea>
                <br>
                <button class="btn btn-primary" onclick="copiarCodigo()">ğŸ“‹ Copiar CÃ³digo</button>
            </div>
        </div>
    </div>

    <script>
        let logOutput = document.getElementById('logOutput');
        let originalConsoleLog = console.log;

        // Interceptar console.log
        console.log = function(...args) {
            originalConsoleLog.apply(console, arguments);
            let message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            logOutput.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logOutput.scrollTop = logOutput.scrollHeight;
        };

        function abrirAdminParaTeste() {
            console.log('ğŸ”— Abrindo pÃ¡gina admin para teste...');
            window.open('admin.html', '_blank');
        }

        function testeCompleto() {
            console.log('ğŸ§ª INICIANDO TESTE COMPLETO DE DIAGNÃ“STICO');
            console.log('===========================================');
            
            // Teste 1: Verificar se funÃ§Ã£o createActionButtons existe
            console.log('\n1. ğŸ” Testando funÃ§Ã£o createActionButtons...');
            try {
                // Simular dados de compra
                const testPurchase = {
                    id: 'test-' + Date.now(),
                    type: 'doacao',
                    status: 'pending',
                    paymentMethod: 'doacao',
                    buyerName: 'Teste Usuario',
                    totalAmount: 50
                };

                console.log('ğŸ“ Dados de teste:', testPurchase);
                
                // Tentar executar a funÃ§Ã£o (se existir)
                if (typeof createActionButtons === 'function') {
                    const result = createActionButtons(testPurchase);
                    console.log('âœ… FunÃ§Ã£o existe e retornou:', result.length, 'caracteres');
                    console.log('ğŸ” Resultado:', result.substring(0, 200) + '...');
                } else {
                    console.log('âŒ FunÃ§Ã£o createActionButtons NÃƒO EXISTE');
                }
            } catch (error) {
                console.log('âŒ ERRO ao testar funÃ§Ã£o:', error.message);
            }

            // Teste 2: Verificar se hÃ¡ botÃµes na pÃ¡gina atual
            console.log('\n2. ğŸ” Verificando botÃµes existentes...');
            try {
                const buttons = document.querySelectorAll('button');
                console.log('ğŸ“Š Total de botÃµes na pÃ¡gina:', buttons.length);
                
                if (buttons.length > 0) {
                    buttons.forEach((btn, i) => {
                        console.log(`  BotÃ£o ${i+1}: "${btn.textContent.trim()}" - onclick: ${!!btn.onclick}`);
                    });
                } else {
                    console.log('âš ï¸ Nenhum botÃ£o encontrado na pÃ¡gina');
                }
            } catch (error) {
                console.log('âŒ ERRO ao verificar botÃµes:', error.message);
            }

            // Teste 3: Tentar criar botÃ£o de teste
            console.log('\n3. ğŸ” Criando botÃ£o de teste...');
            try {
                const testButton = document.createElement('button');
                testButton.textContent = 'ğŸ§ª Teste';
                testButton.style.cssText = 'background: #28a745; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; margin: 10px;';
                testButton.onclick = function() {
                    alert('BotÃ£o de teste funcionou!');
                    console.log('âœ… BotÃ£o de teste clicado com sucesso!');
                };
                
                document.body.appendChild(testButton);
                console.log('âœ… BotÃ£o de teste criado e adicionado Ã  pÃ¡gina');
            } catch (error) {
                console.log('âŒ ERRO ao criar botÃ£o de teste:', error.message);
            }

            // Teste 4: Verificar localStorage e dados
            console.log('\n4. ğŸ” Verificando dados armazenados...');
            try {
                const adminData = localStorage.getItem('admin_purchases_backup');
                if (adminData) {
                    const purchases = JSON.parse(adminData);
                    console.log('ğŸ“Š Dados encontrados no localStorage:', purchases.length, 'compras');
                    console.log('ğŸ” Primeira compra:', purchases[0]);
                } else {
                    console.log('âš ï¸ Nenhum dado encontrado no localStorage');
                }
            } catch (error) {
                console.log('âŒ ERRO ao verificar localStorage:', error.message);
            }

            console.log('\n===========================================');
            console.log('ğŸ§ª DIAGNÃ“STICO COMPLETO FINALIZADO');
            
            // Mostrar soluÃ§Ãµes
            mostrarSolucoes();
        }

        function mostrarSolucoes() {
            const solucoesDiv = document.getElementById('solucoes');
            const codigoTextarea = document.getElementById('codigoEmergencia');
            
            const codigoEmergencia = `
// ğŸš¨ CÃ“DIGO DE EMERGÃŠNCIA - Cole no console da pÃ¡gina admin.html
console.log('ğŸš¨ APLICANDO SOLUÃ‡ÃƒO DE EMERGÃŠNCIA');

// 1. Redefinir funÃ§Ã£o createActionButtons
window.createActionButtons = function(purchase) {
    console.log('ğŸš¨ EMERGÃŠNCIA: Criando botÃµes para', purchase?.id);
    
    const id = purchase?.id || 'emergency-' + Date.now();
    
    return \`
        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
            <button onclick="alert('Editar: \${id}'); console.log('Editar:', '\${id}');" style="background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                âœï¸ Editar
            </button>
            <button onclick="alert('Debug: \${id}'); console.log('Debug:', '\${id}');" style="background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                ğŸ” Debug
            </button>
            <button onclick="alert('Confirmar: \${id}'); console.log('Confirmar:', '\${id}');" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                âœ… Confirmar
            </button>
            <button onclick="alert('Rejeitar: \${id}'); console.log('Rejeitar:', '\${id}');" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                âŒ Rejeitar
            </button>
        </div>
    \`;
};

// 2. ForÃ§ar botÃµes em todas as linhas existentes
document.querySelectorAll('#participantsTable tbody tr').forEach((row, index) => {
    const actionCell = row.querySelector('td:last-child');
    if (actionCell) {
        const mockPurchase = { id: 'forced-' + (index + 1) };
        actionCell.innerHTML = window.createActionButtons(mockPurchase);
        console.log(\`âœ… Linha \${index + 1} corrigida\`);
    }
});

// 3. Configurar observador para manter botÃµes
const tbody = document.querySelector('#participantsTable tbody');
if (tbody) {
    const observer = new MutationObserver(() => {
        console.log('ğŸ”„ Tabela modificada, verificando botÃµes...');
        setTimeout(() => {
            document.querySelectorAll('#participantsTable tbody tr').forEach((row, index) => {
                const actionCell = row.querySelector('td:last-child');
                if (actionCell && !actionCell.querySelector('button')) {
                    const mockPurchase = { id: 'auto-' + (index + 1) };
                    actionCell.innerHTML = window.createActionButtons(mockPurchase);
                    console.log(\`ğŸš¨ Auto-correÃ§Ã£o linha \${index + 1}\`);
                }
            });
        }, 100);
    });
    
    observer.observe(tbody, { childList: true, subtree: true });
    console.log('ğŸ‘ï¸ Observador ativado');
}

console.log('âœ… SOLUÃ‡ÃƒO DE EMERGÃŠNCIA APLICADA');
console.log('ğŸ’¡ Os botÃµes devem aparecer agora e ser mantidos automaticamente');
`;

            codigoTextarea.value = codigoEmergencia;
            solucoesDiv.style.display = 'block';
            
            console.log('ğŸ“‹ CÃ³digo de emergÃªncia preparado');
        }

        function copiarCodigo() {
            const textarea = document.getElementById('codigoEmergencia');
            textarea.select();
            document.execCommand('copy');
            console.log('ğŸ“‹ CÃ³digo copiado para Ã¡rea de transferÃªncia');
            alert('âœ… CÃ³digo copiado! Cole no console da pÃ¡gina admin (F12)');
        }

        function criarBotoesDeEmergencia() {
            console.log('ğŸš¨ Criando botÃµes de emergÃªncia nesta pÃ¡gina...');
            
            const container = document.createElement('div');
            container.style.cssText = 'margin: 20px 0; padding: 15px; border: 2px solid #dc3545; border-radius: 5px; background: #f8d7da;';
            container.innerHTML = `
                <h3>ğŸš¨ BotÃµes de EmergÃªncia - Teste</h3>
                <p>Estes botÃµes testam se o JavaScript bÃ¡sico estÃ¡ funcionando:</p>
                <button onclick="alert('Editar funcionou!')" style="background: #007bff; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 4px; cursor: pointer;">âœï¸ Teste Editar</button>
                <button onclick="console.log('Debug funcionou!')" style="background: #6c757d; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 4px; cursor: pointer;">ğŸ” Teste Debug</button>
                <button onclick="alert('Confirmar funcionou!')" style="background: #28a745; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 4px; cursor: pointer;">âœ… Teste Confirmar</button>
                <button onclick="alert('Rejeitar funcionou!')" style="background: #dc3545; color: white; border: none; padding: 8px 16px; margin: 5px; border-radius: 4px; cursor: pointer;">âŒ Teste Rejeitar</button>
            `;
            
            document.body.appendChild(container);
            console.log('âœ… BotÃµes de emergÃªncia criados');
        }

        // Auto-executar teste bÃ¡sico ao carregar
        window.addEventListener('load', function() {
            console.log('ğŸ”§ DIAGNÃ“STICO CARREGADO - Pronto para teste');
            setTimeout(() => {
                console.log('ğŸ” Executando verificaÃ§Ã£o inicial...');
                const buttons = document.querySelectorAll('button');
                console.log('ğŸ“Š BotÃµes encontrados na pÃ¡gina:', buttons.length);
            }, 1000);
        });
    </script>
</body>
</html>
