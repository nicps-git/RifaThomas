<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Diagn√≥stico do Salvamento de Configura√ß√£o</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .test-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .test-section h3 {
            color: #495057;
            margin-top: 0;
        }

        .status-log {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
            font-size: 14px;
        }

        .form-group {
            margin: 10px 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 14px;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }

        .btn-warning { background: #ffc107; color: #000; }
        .btn-warning:hover { background: #e0a800; }

        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }

        .result {
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }

        .result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Diagn√≥stico do Salvamento de Configura√ß√£o</h1>
        
        <!-- Se√ß√£o de Status do Sistema -->
        <div class="test-section">
            <h3>üìä Status do Sistema</h3>
            <div class="status-log" id="status-log">
                Aguardando teste...
            </div>
            <button class="btn" onclick="checkSystemStatus()">üîç Verificar Status do Sistema</button>
        </div>

        <!-- Formul√°rio de Teste -->
        <div class="test-section">
            <h3>üìù Teste de Salvamento</h3>
            <form id="test-config-form">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="test-total-numbers">Total de N√∫meros:</label>
                        <input type="number" id="test-total-numbers" min="100" max="10000" value="200">
                    </div>
                    <div class="form-group">
                        <label for="test-ticket-price">Pre√ßo (R$):</label>
                        <input type="number" id="test-ticket-price" min="1" step="0.01" value="50.00">
                    </div>
                    <div class="form-group">
                        <label for="test-baby-name">Nome do Beb√™:</label>
                        <input type="text" id="test-baby-name" value="Thomas Teste">
                    </div>
                    <div class="form-group">
                        <label for="test-contact-phone">Telefone:</label>
                        <input type="tel" id="test-contact-phone" value="(11) 98765-4321">
                    </div>
                    <div class="form-group">
                        <label for="test-pix-key">Chave PIX:</label>
                        <input type="text" id="test-pix-key" value="teste@email.com">
                    </div>
                    <div class="form-group">
                        <label for="test-first-prize">1¬∫ Pr√™mio:</label>
                        <input type="text" id="test-first-prize" value="R$ 150,00">
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button type="button" class="btn btn-success" onclick="testSaveConfiguration()">
                        üíæ Testar Salvamento
                    </button>
                    <button type="button" class="btn btn-warning" onclick="testLoadConfiguration()">
                        üìÇ Testar Carregamento
                    </button>
                    <button type="button" class="btn btn-danger" onclick="clearStoredConfig()">
                        üóëÔ∏è Limpar Dados Salvos
                    </button>
                </div>
            </form>
        </div>

        <!-- Resultados -->
        <div class="test-section">
            <h3>üìã Resultados</h3>
            <div id="test-results">
                Nenhum teste executado ainda.
            </div>
        </div>

        <!-- Dados Salvos -->
        <div class="test-section">
            <h3>üíæ Dados Salvos Atualmente</h3>
            <div class="status-log" id="stored-data">
                Carregando...
            </div>
            <button class="btn" onclick="showStoredData()">üîç Mostrar Dados Salvos</button>
        </div>
    </div>

    <script>
        let testLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testLog.push(`[${timestamp}] ${message}`);
            
            const statusLog = document.getElementById('status-log');
            statusLog.innerHTML = testLog.slice(-20).join('\n');
            statusLog.scrollTop = statusLog.scrollHeight;
            
            console.log(`[TESTE] ${message}`);
        }

        function showResult(message, success = true) {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${success ? 'success' : 'error'}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);
            
            // Manter apenas os √∫ltimos 5 resultados
            while (resultsDiv.children.length > 5) {
                resultsDiv.removeChild(resultsDiv.firstChild);
            }
        }

        function checkSystemStatus() {
            log('üîç Iniciando verifica√ß√£o do sistema...');
            
            try {
                // Verificar localStorage
                const hasLocalStorage = typeof Storage !== 'undefined';
                log(`üì¶ localStorage: ${hasLocalStorage ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o dispon√≠vel'}`);
                
                // Verificar se h√° dados salvos
                const savedConfig = localStorage.getItem('adminConfig');
                log(`üíæ Configura√ß√£o salva: ${savedConfig ? '‚úÖ Encontrada' : '‚ùå N√£o encontrada'}`);
                
                if (savedConfig) {
                    try {
                        const config = JSON.parse(savedConfig);
                        log(`üìä Dados v√°lidos: ${config.totalNumbers || 'N/A'} n√∫meros, R$ ${config.ticketPrice || 'N/A'}`);
                    } catch (e) {
                        log(`‚ö†Ô∏è Dados corrompidos: ${e.message}`);
                    }
                }
                
                // Verificar formul√°rio principal
                const mainForm = document.getElementById('config-form');
                log(`üìù Formul√°rio principal: ${mainForm ? '‚úÖ Encontrado' : '‚ùå N√£o encontrado'}`);
                
                // Verificar se admin.js tem as fun√ß√µes
                const hasSaveFunction = typeof window.saveConfiguration === 'function';
                const hasLoadFunction = typeof window.loadConfiguration === 'function';
                log(`‚öôÔ∏è Fun√ß√£o saveConfiguration: ${hasSaveFunction ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o dispon√≠vel'}`);
                log(`üìÇ Fun√ß√£o loadConfiguration: ${hasLoadFunction ? '‚úÖ Dispon√≠vel' : '‚ùå N√£o dispon√≠vel'}`);
                
                showResult('‚úÖ Verifica√ß√£o do sistema conclu√≠da - verifique o log para detalhes');
                
            } catch (error) {
                log(`‚ùå Erro na verifica√ß√£o: ${error.message}`);
                showResult('‚ùå Erro durante a verifica√ß√£o do sistema', false);
            }
        }

        function testSaveConfiguration() {
            log('üíæ Iniciando teste de salvamento...');
            
            try {
                // Coletar dados do formul√°rio de teste
                const testConfig = {
                    totalNumbers: parseInt(document.getElementById('test-total-numbers').value),
                    ticketPrice: parseFloat(document.getElementById('test-ticket-price').value),
                    babyName: document.getElementById('test-baby-name').value,
                    contactPhone: document.getElementById('test-contact-phone').value,
                    pixKey: document.getElementById('test-pix-key').value,
                    prizes: {
                        first: document.getElementById('test-first-prize').value,
                        second: 'R$ 100,00',
                        third: 'Kit beb√™'
                    },
                    drawDate: new Date('2025-07-15T16:00:00'),
                    testMode: true,
                    timestamp: new Date().toISOString()
                };
                
                log(`üìù Dados coletados: ${testConfig.totalNumbers} n√∫meros, R$ ${testConfig.ticketPrice}`);
                
                // Valida√ß√µes
                if (testConfig.totalNumbers < 100 || testConfig.totalNumbers > 10000) {
                    throw new Error('Total de n√∫meros deve estar entre 100 e 10000');
                }
                
                if (testConfig.ticketPrice < 1) {
                    throw new Error('Pre√ßo deve ser maior que R$ 1,00');
                }
                
                if (!testConfig.pixKey || !testConfig.contactPhone) {
                    throw new Error('PIX e telefone s√£o obrigat√≥rios');
                }
                
                log('‚úÖ Valida√ß√µes passaram');
                
                // Salvar no localStorage
                localStorage.setItem('adminConfig', JSON.stringify(testConfig));
                log('üíæ Dados salvos no localStorage');
                
                // Verificar se foi salvo corretamente
                const saved = localStorage.getItem('adminConfig');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (parsed.testMode && parsed.timestamp === testConfig.timestamp) {
                        log('‚úÖ Verifica√ß√£o de integridade passou');
                        showResult('‚úÖ Configura√ß√£o salva com sucesso!');
                    } else {
                        throw new Error('Dados salvos n√£o coincidem');
                    }
                } else {
                    throw new Error('Falha ao salvar no localStorage');
                }
                
            } catch (error) {
                log(`‚ùå Erro no teste de salvamento: ${error.message}`);
                showResult(`‚ùå Erro no salvamento: ${error.message}`, false);
            }
        }

        function testLoadConfiguration() {
            log('üìÇ Iniciando teste de carregamento...');
            
            try {
                const savedConfig = localStorage.getItem('adminConfig');
                if (!savedConfig) {
                    throw new Error('Nenhuma configura√ß√£o salva encontrada');
                }
                
                const config = JSON.parse(savedConfig);
                log(`üìä Configura√ß√£o carregada: ${config.totalNumbers} n√∫meros, R$ ${config.ticketPrice}`);
                
                // Carregar nos campos do formul√°rio de teste
                document.getElementById('test-total-numbers').value = config.totalNumbers || 150;
                document.getElementById('test-ticket-price').value = config.ticketPrice || 40.00;
                document.getElementById('test-baby-name').value = config.babyName || 'Thomas';
                document.getElementById('test-contact-phone').value = config.contactPhone || '(11) 99999-9999';
                document.getElementById('test-pix-key').value = config.pixKey || 'contato@email.com';
                document.getElementById('test-first-prize').value = config.prizes?.first || 'R$ 100,00';
                
                log('‚úÖ Dados carregados nos campos do formul√°rio');
                showResult('‚úÖ Configura√ß√£o carregada com sucesso!');
                
            } catch (error) {
                log(`‚ùå Erro no teste de carregamento: ${error.message}`);
                showResult(`‚ùå Erro no carregamento: ${error.message}`, false);
            }
        }

        function clearStoredConfig() {
            log('üóëÔ∏è Limpando dados salvos...');
            
            try {
                localStorage.removeItem('adminConfig');
                log('‚úÖ Dados removidos do localStorage');
                showResult('‚úÖ Dados salvos removidos com sucesso!');
                showStoredData(); // Atualizar visualiza√ß√£o
                
            } catch (error) {
                log(`‚ùå Erro ao limpar dados: ${error.message}`);
                showResult(`‚ùå Erro ao limpar: ${error.message}`, false);
            }
        }

        function showStoredData() {
            log('üìã Mostrando dados salvos...');
            
            try {
                const savedConfig = localStorage.getItem('adminConfig');
                const storedDataDiv = document.getElementById('stored-data');
                
                if (!savedConfig) {
                    storedDataDiv.textContent = 'Nenhuma configura√ß√£o salva encontrada.';
                    return;
                }
                
                const config = JSON.parse(savedConfig);
                const formatted = JSON.stringify(config, null, 2);
                storedDataDiv.textContent = formatted;
                
                log('‚úÖ Dados exibidos');
                
            } catch (error) {
                log(`‚ùå Erro ao exibir dados: ${error.message}`);
                document.getElementById('stored-data').textContent = `Erro: ${error.message}`;
            }
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina de diagn√≥stico carregada');
            checkSystemStatus();
            showStoredData();
        });
    </script>
</body>
</html>
