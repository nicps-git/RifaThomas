<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Sincroniza√ß√£o N√∫meros</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .success { border-left-color: #28a745; }
        .warning { border-left-color: #ffc107; }
        .error { border-left-color: #dc3545; }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        
        button:hover { background: #0056b3; }
        .success-btn { background: #28a745; }
        .warning-btn { background: #ffc107; color: black; }
        .danger-btn { background: #dc3545; }
        
        .log {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #ddd;
        }
        
        .numbers-display {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 5px;
            margin: 10px 0;
        }
        
        .number-card {
            padding: 8px;
            text-align: center;
            border-radius: 4px;
            font-weight: bold;
            color: white;
        }
        
        .sold { background: #dc3545; }
        .reserved { background: #ffc107; color: black; }
        .available { background: #28a745; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Sincroniza√ß√£o - N√∫meros Vendidos</h1>
    <p>Esta p√°gina testa se a p√°gina principal sincroniza corretamente com dados confirmados no admin.</p>

    <div class="section">
        <h2>üìã 1. Simular Compras</h2>
        <button onclick="createTestPurchase()" class="success-btn">‚úÖ Criar Compra Confirmada</button>
        <button onclick="createPendingPurchase()" class="warning-btn">‚è≥ Criar Compra Pendente</button>
        <button onclick="clearTestData()" class="danger-btn">üóëÔ∏è Limpar Dados de Teste</button>
        
        <div id="purchase-log" class="log">Clique em "Criar Compra Confirmada" para testar...</div>
    </div>

    <div class="section">
        <h2>üî¢ 2. Status dos N√∫meros</h2>
        <button onclick="checkNumbersStatus()">üîç Verificar Status dos N√∫meros</button>
        <button onclick="openMainPage()">üè† Abrir P√°gina Principal</button>
        
        <div id="numbers-status" class="log">Clique em "Verificar Status" para ver...</div>
        
        <h3>N√∫meros de Teste (1-20):</h3>
        <div id="numbers-display" class="numbers-display"></div>
    </div>

    <div class="section">
        <h2>‚ö° 3. Teste de Sincroniza√ß√£o Autom√°tica</h2>
        <p>Este teste verifica se a p√°gina principal atualiza automaticamente quando h√° mudan√ßas no admin.</p>
        
        <button onclick="startSyncTest()" class="success-btn">üöÄ Iniciar Teste Autom√°tico</button>
        <button onclick="stopSyncTest()" class="danger-btn">‚èπÔ∏è Parar Teste</button>
        
        <div id="sync-log" class="log">Teste n√£o iniciado...</div>
    </div>

    <script>
        let testNumbers = [];
        let syncTestInterval = null;
        
        function log(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            container.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            container.scrollTop = container.scrollHeight;
            console.log(`${prefix} ${message}`);
        }

        function createTestPurchase() {
            const testNumber = Math.floor(Math.random() * 20) + 1; // N√∫meros 1-20
            testNumbers.push(testNumber);
            
            const testPurchase = {
                id: `test-confirmed-${Date.now()}`,
                buyerName: `Teste Confirmado ${testNumber}`,
                buyerPhone: '(11) 99999-9999',
                numbers: [testNumber],
                totalAmount: 40.00,
                paymentMethod: 'pix',
                status: 'confirmed',
                timestamp: new Date().toISOString()
            };
            
            // Adicionar ao localStorage
            const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
            purchases.push(testPurchase);
            localStorage.setItem('purchases', JSON.stringify(purchases));
            
            log('purchase-log', `Compra CONFIRMADA criada - N√∫mero ${testNumber}`, 'success');
            checkNumbersStatus();
            updateNumbersDisplay();
        }

        function createPendingPurchase() {
            const testNumber = Math.floor(Math.random() * 20) + 1; // N√∫meros 1-20
            testNumbers.push(testNumber);
            
            const testPurchase = {
                id: `test-pending-${Date.now()}`,
                buyerName: `Teste Pendente ${testNumber}`,
                buyerPhone: '(11) 99999-9999',
                numbers: [testNumber],
                totalAmount: 40.00,
                paymentMethod: 'doacao',
                status: 'pending_donation',
                timestamp: new Date().toISOString()
            };
            
            // Adicionar ao localStorage
            const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
            purchases.push(testPurchase);
            localStorage.setItem('purchases', JSON.stringify(purchases));
            
            log('purchase-log', `Compra PENDENTE criada - N√∫mero ${testNumber}`, 'warning');
            checkNumbersStatus();
            updateNumbersDisplay();
        }

        function clearTestData() {
            if (!confirm('Limpar todos os dados de teste?')) return;
            
            const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
            const filteredPurchases = purchases.filter(p => !p.id.startsWith('test-'));
            localStorage.setItem('purchases', JSON.stringify(filteredPurchases));
            
            testNumbers = [];
            
            log('purchase-log', 'Dados de teste limpos', 'warning');
            checkNumbersStatus();
            updateNumbersDisplay();
        }

        function checkNumbersStatus() {
            const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
            
            const confirmedNumbers = new Set();
            const pendingNumbers = new Set();
            
            purchases.forEach(purchase => {
                if (purchase.status === 'confirmed' && purchase.numbers) {
                    purchase.numbers.forEach(num => confirmedNumbers.add(num));
                } else if (purchase.status === 'pending_donation' && purchase.numbers) {
                    purchase.numbers.forEach(num => pendingNumbers.add(num));
                }
            });
            
            const statusText = `
üìä STATUS ATUAL:
- Total de compras: ${purchases.length}
- N√∫meros confirmados (${confirmedNumbers.size}): [${Array.from(confirmedNumbers).sort((a,b) => a-b).join(', ')}]
- N√∫meros pendentes (${pendingNumbers.size}): [${Array.from(pendingNumbers).sort((a,b) => a-b).join(', ')}]

üîç AN√ÅLISE:
- Confirmados devem aparecer como VERMELHOS na p√°gina principal
- Pendentes devem aparecer como AMARELOS na p√°gina principal
            `;
            
            document.getElementById('numbers-status').textContent = statusText;
            updateNumbersDisplay();
        }

        function updateNumbersDisplay() {
            const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
            const display = document.getElementById('numbers-display');
            display.innerHTML = '';
            
            const confirmedNumbers = new Set();
            const pendingNumbers = new Set();
            
            purchases.forEach(purchase => {
                if (purchase.status === 'confirmed' && purchase.numbers) {
                    purchase.numbers.forEach(num => confirmedNumbers.add(num));
                } else if (purchase.status === 'pending_donation' && purchase.numbers) {
                    purchase.numbers.forEach(num => pendingNumbers.add(num));
                }
            });
            
            // Mostrar n√∫meros 1-20
            for (let i = 1; i <= 20; i++) {
                const card = document.createElement('div');
                card.className = 'number-card';
                card.textContent = i.toString().padStart(2, '0');
                
                if (confirmedNumbers.has(i)) {
                    card.classList.add('sold');
                    card.title = 'Confirmado - deve aparecer VERMELHO na p√°gina principal';
                } else if (pendingNumbers.has(i)) {
                    card.classList.add('reserved');
                    card.title = 'Pendente - deve aparecer AMARELO na p√°gina principal';
                } else {
                    card.classList.add('available');
                    card.title = 'Dispon√≠vel - deve aparecer VERDE na p√°gina principal';
                }
                
                display.appendChild(card);
            }
        }

        function openMainPage() {
            window.open('index.html', '_blank');
            log('numbers-status', 'P√°gina principal aberta. Compare os n√∫meros exibidos aqui com os da p√°gina principal.', 'info');
        }

        function startSyncTest() {
            if (syncTestInterval) {
                log('sync-log', 'Teste j√° est√° rodando!', 'warning');
                return;
            }
            
            log('sync-log', 'Iniciando teste de sincroniza√ß√£o autom√°tica...', 'info');
            log('sync-log', 'O teste criar√° compras a cada 5 segundos e verificar√° se a p√°gina principal sincroniza.', 'info');
            
            let testCount = 0;
            syncTestInterval = setInterval(() => {
                testCount++;
                
                if (testCount <= 5) { // M√°ximo 5 testes autom√°ticos
                    const randomNumber = Math.floor(Math.random() * 20) + 1;
                    const isConfirmed = Math.random() > 0.5;
                    
                    const testPurchase = {
                        id: `auto-test-${Date.now()}`,
                        buyerName: `Auto Teste ${testCount}`,
                        buyerPhone: '(11) 99999-9999',
                        numbers: [randomNumber],
                        totalAmount: 40.00,
                        paymentMethod: isConfirmed ? 'pix' : 'doacao',
                        status: isConfirmed ? 'confirmed' : 'pending_donation',
                        timestamp: new Date().toISOString()
                    };
                    
                    const purchases = JSON.parse(localStorage.getItem('purchases') || '[]');
                    purchases.push(testPurchase);
                    localStorage.setItem('purchases', JSON.stringify(purchases));
                    
                    const statusText = isConfirmed ? 'CONFIRMADA (vermelho)' : 'PENDENTE (amarelo)';
                    log('sync-log', `Teste ${testCount}: Criada compra ${statusText} - N√∫mero ${randomNumber}`, isConfirmed ? 'success' : 'warning');
                    log('sync-log', `> Verifique se o n√∫mero ${randomNumber} mudou na p√°gina principal`, 'info');
                    
                    updateNumbersDisplay();
                } else {
                    stopSyncTest();
                    log('sync-log', '‚úÖ Teste autom√°tico conclu√≠do! Verifique se todos os n√∫meros sincronizaram na p√°gina principal.', 'success');
                }
            }, 5000);
        }

        function stopSyncTest() {
            if (syncTestInterval) {
                clearInterval(syncTestInterval);
                syncTestInterval = null;
                log('sync-log', 'Teste autom√°tico parado.', 'warning');
            }
        }

        // Inicializa√ß√£o
        window.addEventListener('load', () => {
            log('purchase-log', 'P√°gina de teste carregada. Pronta para testar sincroniza√ß√£o!', 'success');
            checkNumbersStatus();
            updateNumbersDisplay();
        });

        // Limpar intervalo ao sair da p√°gina
        window.addEventListener('beforeunload', () => {
            if (syncTestInterval) {
                clearInterval(syncTestInterval);
            }
        });
    </script>
</body>
</html>
